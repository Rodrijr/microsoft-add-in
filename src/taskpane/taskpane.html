<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contoso Task Pane Add-in</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link rel="stylesheet"
        href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css" />

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <meta name="referrer" content="unsafe-url">
    <script src="taskpane.js"></script> <!-- Referencia al archivo JavaScript -->

</head>

<body class="ms-font-m ms-welcome ms-Fabric">
    42

    +++++++++++++++++++++++++++++++++++++++++++++++++++++++ 222222222
        <iframe referrerpolicy="strict-origin-when-cross-origin" src="https://iadbdev.service-now.com/login.do"
            id="miIframe" style="height:100vh;width:100vw;" name="miIframe" onload="handleIframe(this)"
            sandbox="allow-top-navigation allow-scripts allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-modals allow-downloads allow-storage-access-by-user-activation">
            #document
            <html>

            <head>
                <script type="text/javascript">
                    window.onload = function () {
                        console.log("hello");
                    }
                </script>
            </head>

            <body>
            </body>

            </html>
        </iframe>
    </div>
    <div id="taskpane-container"></div>

    <script>
        async function handleIframe(contesto){
            console.log('JRBP -> contesto:', contesto);
            await fetch("https://iadbdev.service-now.com/login.do", {
                "headers": {
                    "content-type": "application/x-www-form-urlencoded",
                    "sec-ch-ua": "\"Chromium\";v=\"128\", \"Not;A=Brand\";v=\"24\", \"Google Chrome\";v=\"128\"",
                    "sec-ch-ua-mobile": "?0",
                    "sec-ch-ua-platform": "\"Windows\"",
                    "upgrade-insecure-requests": "1",
                    "Referer": "https://rodrijr.github.io",
                    "Referrer-Policy": "same-origin"
                },
                "body": "sysparm_ck=59d51e2f479452d46f0ee52f016d43e6853443e8b933c9c89a15a2e1084eba8bbf2668c7&user_name=autocad_integration&user_password=AutoCadIntegration67%3D&ni.nolog.user_password=true&ni.noecho.user_name=true&ni.noecho.user_password=true&language_select=en&screensize=1920x1080&sys_action=sysverb_login&not_important=",
                "method": "POST"
            });
            console.log('LLEGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO')
        }
        // Espera el mensaje del iframe una vez que se haya cargado la página
    window.addEventListener('message', function (event) {
        // Verifica que el mensaje provenga del origen correcto
        if (event.origin === 'https://iadbdev.service-now.com' && event.data === 'iframe_loaded') {
            // Envía un mensaje al iframe para iniciar el fetch, especificando el origen correcto
            const iframe = document.getElementById('miIframe');
            iframe.contentWindow.postMessage('start_fetch', 'https://iadbdev.service-now.com');
        }
    });
    </script>
</body>




</html>